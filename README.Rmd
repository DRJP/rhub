---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# rhub <img src='man/figures/logo.png' align="right" height="138.5" />

> Connect to R-hub, from R

<!-- badges: start -->
[![Linux Build Status](https://travis-ci.org/r-hub/rhub.svg?branch=master)](https://travis-ci.org/r-hub/rhub)
[![Windows Build status](https://ci.appveyor.com/api/projects/status/github/r-hub/rhub?svg=true)](https://ci.appveyor.com/project/gaborcsardi/rhub)
[![](http://www.r-pkg.org/badges/version/rhub)](http://www.r-pkg.org/pkg/rhub)
[![CRAN RStudio mirror downloads](http://cranlogs.r-pkg.org/badges/rhub)](http://www.r-pkg.org/pkg/rhub)
[![Coverage Status](https://img.shields.io/codecov/c/github/r-hub/rhub/master.svg)](https://codecov.io/github/r-hub/rhub?branch=master)
[![Project Status: Active – The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
<!-- badges: end -->

Run `R CMD check` on any of the R-hub builder architectures, from R.

## Introduction

The [R-hub builder](https://builder.r-hub.io/) is a multi-platform build and
check service for R packages. This packages uses the R-hub API to connect to
the R-hub builder and start package checks on various architectures.

It also supports accessing statuses of previous checks, and local use of the
R-hub Linux platforms via Docker.

## Installation

Install the package from CRAN:

```r
install.packages("rhub")
```

Or get the development version from GitHub:

```r
# install.packages("remotes")
remotes::install_github("r-hub/rhub")
```

## Basic usage

```{r}
library(rhub)
```

### Validating your email address

To build packages, first you need to validate your email address with
`validate_email()`. The package tries to detect your email address using [`whoami`](https://github.com/r-lib/whoami#whoami) and the maintainer email
listed in DESCRIPTION; and if it fails to do this correctly, you'll need to
specify it.

![](man/figures/email-validation.png)

`rhub` stores the token permanently on the machine, so you do not need
to validate your email again. You can also copy your token to other
machines: run `list_validated_emails()` to get the token, and use the 
`validate_email()` function on the new machine, using both the `email` and
 `token` arguments.

Currently you cannot use the token obtained via this function in the Web
UI of the R-hub builder.


### Running a package check

`check()` runs an `R CMD check` on the package in the specified directory,
or specified source R package tarball created by `R CMD build` or
`devtools::build()`. It defaults to the working directory.

```r
check()
```

If the `platform` argument is NULL, and the R session is interactive, then 
a menu is shown. If it is NULL, and the session is not interactive, then the
default R-hub platform `platforms()$name[1]`, i.e. `r platforms()$name[1]`,
is used.

In interactive R sessions, the output of the check is printed to
the screen unless you set the `show_status` argument to `FALSE`. In all cases,
 you will receive a notification email with results after the build.

![](man/figures/check-output.gif)


### Listing R-hub platforms

You can run checks on any platform. You can use the platform ids (e.g. `debian-gcc-devel`) to select between platforms. You should not run checks on all 
platforms at once.  If preparing for a CRAN submission, use the shortcut function
`check_for_cran()` that will submit your package to a few recommended
platforms. If looking for a platform with particular characteristics, in 
particular to reproduce a result from CRAN's own platform, have a look at the
R-hub platform characteristics.

```{r platforms-info}
knitr::kable(platforms())
```

### Shortcuts for quick checks

These are quick shortcuts that select the right platform:

* `check_on_linux()` and `check_on_windows()` select the operating system.
* `check_on_debian()`, `check_on_ubuntu()`, `check_on_fedora()` and
  `check_on_centos()` select an appropriate Linux platform.
* `check_with_roldrel()`, `check_with_rrelease()`, `check_with_rpatched()`
  and `check_with_rdevel()` select an R version.
* `check_with_valgrind()` runs the build and check on Linux, in `valgrind`
  to find memory leaks and pointer errors.
* `check_with_sanitizers()` runs all package package tests, examples and
  vignettes with Address Sanitizer and Undefined Behavior Sanitizer, see
  below.

### Shortcut for preparing a CRAN submission

`check_for_cran()`: Check an R-package on R-hub, for a CRAN submission.

### Sanitizers for compiled code

R-hub provides a special Docker image to run Address Sanitizer (ASAN) and
Undefined Behavior Sanitizer (UBSAN). This is based on the `r-devel-san`
image of the [Rocker project](https://github.com/rocker-org/r-devel-san).

This image does not run `R CMD check` at all, but it runs

1. package tests,
2. all manual examples, and
3. all vignette code

with ASAN and UBSAN enabled.

## License

MIT © R Consortium
